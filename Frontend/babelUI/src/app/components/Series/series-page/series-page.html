<div class="series-page-container">
  <div *ngIf="loading" class="loading">
    <p>Loading series details...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="!loading && !error && series" class="series-details">
    <!-- Back to All Series -->
    <div class="back-link">
      <a routerLink="/series">â† Back to All Series</a>
    </div>

    <!-- Series Header -->
    <div class="series-header">
      <div class="series-cover">
        <img 
          [src]="series.cover_image_url || 'https://via.placeholder.com/400x600.png?text=No+Cover'" 
          [alt]="series.title"
        />
      </div>
      
      <div class="series-info">
        <h1>{{ series.title }}</h1>
        <p class="author" *ngIf="series.author">
          <strong>By:</strong> {{ series.author }}
        </p>
        
        <div class="series-meta">
          <span class="status" [class]="series.status.toLowerCase()">
            {{ series.status }}
          </span>
          <span class="chapter-count">{{ chapters.length || 0 }} Chapters</span>
          <span class="view-count">ğŸ‘ {{ series.total_view_count || 0 }} views</span>
        </div>

        <!-- Rating Display -->
        <div class="rating-section">
          <app-star-rating 
            [rating]="series.average_rating" 
            [showValue]="true"
          ></app-star-rating>
        </div>

        <div class="genres" *ngIf="series.genres && series.genres.length > 0">
          <span *ngFor="let genre of series.genres" class="genre-tag">
            {{ genre.name }}
          </span>
        </div>

        <p class="description" *ngIf="series.description">
          {{ series.description }}
        </p>

        <div class="series-dates">
          <p><strong>Created:</strong> {{ series.created_at | date:'mediumDate' }}</p>
          <p><strong>Last Updated:</strong> {{ series.updated_at | date:'mediumDate' }}</p>
        </div>

        <!-- Bookmark Button -->
        <div *ngIf="isLoggedIn" class="bookmark-section">
          <button 
            class="bookmark-button" 
            [class.bookmarked]="currentBookmark"
            (click)="toggleBookmark()"
            [disabled]="bookmarkLoading"
          >
            <span class="bookmark-icon">{{ currentBookmark ? 'â˜…' : 'â˜†' }}</span>
            {{ currentBookmark ? 'Bookmarked' : 'Add Bookmark' }}
          </button>
          <p class="bookmark-note">
            Bookmark this series to quickly pick up where you left off from your profile.
          </p>
        </div>

        <!-- Rating Submission (only for logged-in users) -->
        <div *ngIf="isLoggedIn" class="rating-submission">
          <app-rating-submit 
            [seriesId]="series.series_id"
            (ratingSubmitted)="onRatingSubmitted()"
          ></app-rating-submit>
        </div>
        <div *ngIf="!isLoggedIn" class="login-prompt">
          <p>Please <a routerLink="/login">log in</a> to rate this series.</p>
        </div>
      </div>
    </div>

    <!-- Chapters List -->
    <div class="chapters-section">
      <h2>Chapters</h2>
      
      <div *ngIf="chapters && chapters.length === 0" class="no-chapters">
        <p>No chapters available yet.</p>
      </div>

      <div *ngIf="chapters && chapters.length > 0" class="chapters-list">
        <a 
          *ngFor="let chapter of chapters" 
          [routerLink]="['/series', series.series_id, 'chapter', chapter.chapter_id]"
          class="chapter-item"
        >
          <div class="chapter-number">Ch. {{ chapter.chapter_number }}</div>
          <div class="chapter-info">
            <h3 class="chapter-title">{{ chapter.title }}</h3>
            <div class="chapter-meta">
              <span *ngIf="chapter.word_count">{{ chapter.word_count }} words</span>
              <span *ngIf="chapter.publication_date">
                {{ chapter.publication_date | date:'mediumDate' }}
              </span>
            </div>
          </div>
        </a>
      </div>
    </div>

    <!-- Comments Section -->
    <div class="comments-section">
      <app-comments 
        [contentType]="'series'" 
        [objectId]="series.series_id">
      </app-comments>
    </div>
  </div>
</div>
